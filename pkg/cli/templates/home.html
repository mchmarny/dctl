{{ define "home" }}

{{ template "header" . }}

<!-- Middle  -->

    <input type="hidden" id="period_months" value="{{ .period_months }}" />

    {{ if .err }}
        <div class="error">
            <p><b>Error:</b> {{ .err }}</p>
        </div>
    {{ end }}

    <section class="search-and-user">
        <form id="home-search-form">
            <input type="search" placeholder="org:name, repo:name, or entity:name" id="search-bar" autocomplete="off">
            <button type="submit" aria-label="submit form">
                <svg aria-hidden="true">
                    <use xlink:href="#search"></use>
                </svg>
            </button>
            <div id="ac-dropdown" class="ac-dropdown"></div>
        </form>
    </section>

    <div class="search-meta">
        <b class="header-term">All imported events</b> over the last <b>{{ .period_months }} months</b>
    </div>
    
    <section class="grid">
        <article>
            <div class="tbl">
                <div class="content-header">
                    Project Health
                </div>
                <div class="tbl-chart tbl-home insights-summary">
                    <div class="insight-card">
                        <span class="insight-label">Bus Factor</span>
                        <span class="insight-val" id="bus-factor-val">—</span>
                        <span class="insight-desc">Developers who account for half of all work. Lower = higher risk if they leave.</span>
                    </div>
                    <div class="insight-card">
                        <span class="insight-label">Pony Factor</span>
                        <span class="insight-val" id="pony-factor-val">—</span>
                        <span class="insight-desc">Organizations behind half of all work. Lower = higher dependency on fewer companies.</span>
                    </div>
                </div>
            </div>
        </article>
        <article>
            <div class="tbl">
                <div class="content-header">
                    Monthly Activity
                </div>
                <div class="tbl-chart tbl-home">
                    <canvas class="chart" id="time-series-chart"></canvas>
                </div>
            </div>
        </article>
        <article>
            <div class="tbl">
                <div class="content-header">
                    Contributor Retention
                </div>
                <div class="tbl-chart tbl-home">
                    <canvas class="chart" id="retention-chart"></canvas>
                </div>
            </div>
        </article>
        <article>
            <div class="tbl" style="position:relative;">
                <div class="content-header">
                    Lowest Reputation Contributors
                </div>
                <div class="tbl-chart tbl-home">
                    <canvas class="chart" id="reputation-chart"></canvas>
                </div>
                <span class="insight-desc">Shallow score (local data only). Click a bar for full GitHub-enriched score.</span>
                <div id="reputation-popover" class="entity-popover">
                    <div class="entity-popover-header">
                        <span id="reputation-popover-title"></span>
                        <button id="reputation-popover-close" class="modal-close">&times;</button>
                    </div>
                    <ul id="reputation-popover-list"></ul>
                </div>
            </div>
        </article>
        <article>
            <div class="tbl" style="position:relative;">
                <div class="content-header">
                    Top Entities (Company or Org)
                </div>
                <div class="tbl-chart tbl-home">
                    <canvas class="chart" id="left-chart"></canvas>
                </div>
                <div id="entity-popover" class="entity-popover">
                    <div class="entity-popover-header">
                        <span id="entity-popover-title"></span>
                        <button id="entity-popover-close" class="modal-close">&times;</button>
                    </div>
                    <ul id="entity-popover-list"></ul>
                </div>
            </div>
        </article>
        <article>
            <div class="tbl">
                <div class="tbl-header">
                     <div class="content-header">
                        Top Colaborators
                    </div>
                </div>
                <div class="tbl-content tbl-home">
                    <canvas class="chart" id="right-chart"></canvas>
                </div>
            </div>
        </article>
        <article>
            <div class="tbl">
                <div class="content-header">
                    PR Review Ratio
                </div>
                <div class="tbl-chart tbl-home">
                    <canvas class="chart" id="pr-ratio-chart"></canvas>
                </div>
            </div>
        </article>
        <article>
            <div class="tbl">
                <div class="content-header">
                    Time to Merge (PRs)
                </div>
                <div class="tbl-chart tbl-home">
                    <canvas class="chart" id="time-to-merge-chart"></canvas>
                </div>
            </div>
        </article>
        <article>
            <div class="tbl">
                <div class="content-header">
                    Time to Close (Issues)
                </div>
                <div class="tbl-chart tbl-home">
                    <canvas class="chart" id="time-to-close-chart"></canvas>
                </div>
            </div>
        </article>
        <article>
            <div class="tbl">
                <div class="content-header">
                    Release Cadence
                </div>
                <div class="tbl-chart tbl-home">
                    <canvas class="chart" id="release-cadence-chart"></canvas>
                </div>
            </div>
        </article>
        <article>
            <div class="tbl">
                <div class="content-header">
                    Repository Metadata
                </div>
                <div class="tbl-chart tbl-home insights-grid" id="repo-meta-container">
                    <span class="insight-label">No metadata imported yet</span>
                </div>
            </div>
        </article>

        <article class="init-hide">
            <div class="tbl bordered">
                <div class="tbl-header">
                    <div class="content-header">
                        Search Results (page <b id="page-number">1</b>)
                    </div>
                </div>
                <div class="tbl-content">
                    <div id="tbl-criteria"></div>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Repo</th>
                                <th>Event Type</th>
                                <th>Developer</th>
                                <th>Entity</th>
                            </tr>
                        </thead>
                        <tbody id="result-table-content"></tbody>
                    </table>
                    <div class="result-pager">
                        <a href="#" id="prev-page">Prev</a> |
                        <a href="#" id="next-page">Next</a>
                    </div>
                </div>            
            </div>
        </article>

    </section>

<!-- End Middle  -->

{{ template "footer" . }}

{{ end }}